var qs,__extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}();!function(a){var b=function(){function a(a){void 0===a&&(a=null),this.token=a}return a}();a.CodeObject=b}(qs||(qs={})),function(a){var b=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.elements=[],b}return __extends(b,a),b}(a.CodeObject);a.CodeArray=b}(qs||(qs={})),function(a){var b=function(a){function b(b,c,d,e){void 0===e&&(e=null);var f=a.call(this,e)||this;return f.member=b,f.value=c,f.assignType=d,f}return __extends(b,a),b}(a.CodeObject);a.CodeAssign=b}(qs||(qs={})),function(a){var b=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.isNew=!1,b}return __extends(b,a),b}(a.CodeObject);a.CodeCallFunction=b}(qs||(qs={})),function(a){var b=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.isObject=!1,b.isExport=!1,b.isAbstract=!1,b.owner=null,b.parent=null,b.variableMap={},b.variableMap_static={},b.functionMap={},b.functionMap_static={},b}return __extends(b,a),b.prototype.addVariable=function(a){a.isStatic?this.variableMap_static[a.name]=a:this.variableMap[a.name]=a},b.prototype.addFunction=function(a){a.isStatic?this.functionMap_static[a.name]=a:this.functionMap[a.name]=a},b.prototype.getFunction=function(a,b){return void 0===b&&(b=!1),b?this.functionMap_static.hasOwnProperty(a)?this.functionMap_static[a]:void 0:this.functionMap.hasOwnProperty(a)?this.functionMap[a]:void 0},b}(a.CodeObject);a.CodeClass=b}(qs||(qs={})),function(a){var b=function(a){function b(b,c){void 0===c&&(c=null);var d=a.call(this,c)||this;return d.value=b,d}return __extends(b,a),b}(a.CodeObject);a.CodeDelete=b}(qs||(qs={})),function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b.prototype.setContextExecutable=function(a){this.blockExecutable=a},b}(a.CodeObject);a.CodeFor=b}(qs||(qs={})),function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(a.CodeObject);a.CodeForIn=b}(qs||(qs={})),function(a){var b=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.variables={},b}return __extends(b,a),b.prototype.setContextExecutable=function(a){this.blockExecutable=a},b}(a.CodeObject);a.CodeForSimple=b}(qs||(qs={})),function(a){var c,b=function(a){function b(b,c,d,e,f,g,h,i){void 0===i&&(i=null);var j=a.call(this,i)||this;return j.isDynamicParams=!1,j.autoCall=!1,j.name=b,j.isStatic=c,j.paramNames=d,j.types=e,j.values=f,j.executable=g,j.isDynamicParams=h,j}return __extends(b,a),b}(a.CodeObject);a.CodeFunction=b,function(a){a[a["Normal"]=0]="Normal",a[a["Get"]=1]="Get",a[a["Set"]=2]="Set"}(c=a.FunctionType||(a.FunctionType={}))}(qs||(qs={})),function(a){var b=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.elseIf=[],b}return __extends(b,a),b.prototype.addElseIf=function(a){this.elseIf.push(a)},b}(a.CodeObject);a.CodeIf=b}(qs||(qs={})),function(a){var c,b=function(a){function b(b,d,e){void 0===d&&(d=null),void 0===e&&(e=null);var f=a.call(this,d)||this;return f.calc=c.NONE,f.value=b,f.parent=e,f}return __extends(b,a),b}(a.CodeObject);a.CodeMember=b,function(a){a[a["NONE"]=0]="NONE",a[a["PRE_INCREMENT"]=1]="PRE_INCREMENT",a[a["POST_INCREMENT"]=2]="POST_INCREMENT",a[a["PRE_DECREMENT"]=3]="PRE_DECREMENT",a[a["POST_DECREMENT"]=4]="POST_DECREMENT"}(c=a.Calc||(a.Calc={}))}(qs||(qs={})),function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(a.CodeObject);a.CodeModule=b}(qs||(qs={})),function(a){var b=function(a){function b(b,c){void 0===c&&(c=null);var d=a.call(this,c)||this;return d.newObject=b,d}return __extends(b,a),b}(a.CodeObject);a.CodeNew=b}(qs||(qs={})),function(a){var b=function(a){function b(b,c,d,e){void 0===e&&(e=null);var f=a.call(this,e)||this;return f.left=c,f.right=b,f.operator=d,f}return __extends(b,a),b}(a.CodeObject);a.CodeOperator=b}(qs||(qs={})),function(a){var b=function(a){function b(b,c){void 0===c&&(c=null);var d=a.call(this,c)||this;return d.value=b,d}return __extends(b,a),b}(a.CodeObject);a.CodeScriptObject=b}(qs||(qs={})),function(a){var b=function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;return b.cases=new Array,b}return __extends(b,a),b.prototype.addCase=function(a){this.cases.push(a)},b}(a.CodeObject);a.CodeSwitch=b}(qs||(qs={})),function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(a.CodeObject);a.CodeTernary=b}(qs||(qs={})),function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(a.CodeObject);a.CodeThrow=b}(qs||(qs={})),function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(a.CodeObject);a.CodeTry=b}(qs||(qs={})),function(a){var b=function(a){function b(b,c){void 0===c&&(c=null);var d=a.call(this,c)||this;return d.value=b,d}return __extends(b,a),b}(a.CodeObject);a.CodeTypeof=b}(qs||(qs={})),function(a){var b=function(a){function b(b,c,d,e,f,g){void 0===g&&(g=null);var h=a.call(this,g)||this;return h.name=b,h.value=c,h.modifier=d,h.isStatic=e,h.type=f,h}return __extends(b,a),b}(a.CodeObject);a.CodeVariable=b}(qs||(qs={})),function(a){var b=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return __extends(b,a),b}(a.CodeObject);a.CodeWhile=b}(qs||(qs={})),function(a){var b=function(){function a(a,b){this.allow=a,this.executable=b}return a}();a.TempCase=b}(qs||(qs={})),function(a){var b=function(){function a(a,b){this.allow=a,this.executable=b}return a}();a.TempCondition=b}(qs||(qs={})),function(a){var b=function(){function b(a,c){this.level=0,this.operator=a,this.level=c,b.init()}return b.init=function(){this.operators||(this.operators={},this.operators[a.TokenType.InclusiveOr]=new b(a.TokenType.InclusiveOr,1),this.operators[a.TokenType.Combine]=new b(a.TokenType.Combine,1),this.operators[a.TokenType.XOR]=new b(a.TokenType.XOR,1),this.operators[a.TokenType.Shi]=new b(a.TokenType.Shi,1),this.operators[a.TokenType.Shr]=new b(a.TokenType.Shr,1),this.operators[a.TokenType.And]=new b(a.TokenType.And,1),this.operators[a.TokenType.Or]=new b(a.TokenType.Or,1),this.operators[a.TokenType.Instanceof]=new b(a.TokenType.Instanceof,2),this.operators[a.TokenType.Equal]=new b(a.TokenType.Equal,2),this.operators[a.TokenType.NotEqual]=new b(a.TokenType.NotEqual,2),this.operators[a.TokenType.Greater]=new b(a.TokenType.Greater,2),this.operators[a.TokenType.GreaterOrEqual]=new b(a.TokenType.GreaterOrEqual,2),this.operators[a.TokenType.Less]=new b(a.TokenType.Less,2),this.operators[a.TokenType.LessOrEqual]=new b(a.TokenType.LessOrEqual,2),this.operators[a.TokenType.Plus]=new b(a.TokenType.Plus,3),this.operators[a.TokenType.Minus]=new b(a.TokenType.Minus,3),this.operators[a.TokenType.Multiply]=new b(a.TokenType.Multiply,4),this.operators[a.TokenType.Divide]=new b(a.TokenType.Divide,4),this.operators[a.TokenType.Modulo]=new b(a.TokenType.Modulo,4))},b.getOper=function(a){return this.init(),void 0!=this.operators[a]?this.operators[a]:null},b}();a.TempOperator=b}(qs||(qs={})),function(a){var b=function(a){function b(b,c){var d=this,e=" 行数:"+(b.line+1)+"  列数:"+b.index+"  标记:"+b.name+"  关键字["+b.lexeme+"]\n	"+c;return d=a.call(this,b?e:c)||this,d.name="脚本执行错误",d}return __extends(b,a),b}(Error);a.ExecutionError=b}(qs||(qs={})),function(a){var b=function(a){function b(b,c){var d=this,e=" 行数:"+(b.line+1)+"  列数:"+b.index+"  标记:"+b.name+"  关键字["+b.lexeme+"]\n	"+c;return d=a.call(this,b?e:c)||this,d.name="脚本解析错误",d}return __extends(b,a),b}(Error);a.ParserError=b}(qs||(qs={})),function(a){var b=function(){function b(a){this.index=0,this.tokens=a}return b.prototype.hasMoreTokens=function(){return this.index<this.tokens.length},b.prototype.readToken=function(){if(!this.hasMoreTokens())throw new Error("Unexpected end of token stream.");return this.tokens[this.index++]},b.prototype.peekToken=function(){if(!this.hasMoreTokens())throw new Error("Unexpected end of token stream.");return this.tokens[this.index]},b.prototype.undoToken=function(){if(this.index<=0)throw new Error("No more tokens to undo.");--this.index},b.prototype.readComma=function(){var b=this.readToken();if(b.type!=a.TokenType.Comma)throw new a.ParserError(b,"Comma ',' expected.")},b.prototype.readIdentifier=function(){var a=this.readToken();return a.lexeme.toString()},b.prototype.readLeftBrace=function(){var b=this.readToken();if(b.type!=a.TokenType.LeftBrace)throw new a.ParserError(b,"Left brace '{' expected.")},b.prototype.readRightPar=function(){var b=this.readToken();if(b.type!=a.TokenType.RightPar)throw new a.ParserError(b,"Right par ')' expected.")},b.prototype.readGreater=function(){var b=this.readToken();if(b.type!=a.TokenType.Greater)throw new a.ParserError(b,"Right par ')' expected.")},b.prototype.readRightBrace=function(){var b=this.readToken();if(b.type!=a.TokenType.RightBrace)throw new a.ParserError(b,"Right brace '}' expected.")},b.prototype.readLeftBracket=function(){var b=this.readToken();if(b.type!=a.TokenType.LeftBracket)throw new a.ParserError(b,"Left bracket '[' expected for array indexing expression.")},b.prototype.readRightBracket=function(){var b=this.readToken();if(b.type!=a.TokenType.RightBracket)throw new a.ParserError(b,"Right bracket ']' expected for array indexing expression.")},b.prototype.readLeftParenthesis=function(){var b=this.readToken();if(b.type!=a.TokenType.LeftPar)throw new a.ParserError(b,"Left parenthesis '(' expected.")},b.prototype.readRightParenthesis=function(){var b=this.readToken();if(b.type!=a.TokenType.RightPar)throw new a.ParserError(b,"Right parenthesis ')' expected.")},b.prototype.readSemiColon=function(){var b=this.readToken();if(b.type!=a.TokenType.SemiColon)throw new a.ParserError(b,"SemiColon ';' expected.")},b.prototype.readVar=function(){var b=this.readToken();if(b.type!=a.TokenType.Var)throw new a.ParserError(b,"Var 'var' expected.")},b.prototype.readIn=function(){var b=this.readToken();if(b.type!=a.TokenType.In)throw new a.ParserError(b,"In 'in' expected.")},b.prototype.readColon=function(){var b=this.readToken();if(b.type!=a.TokenType.Colon)throw new a.ParserError(b,"Colon ':' expected.")},b.prototype.readModule=function(){var b=this.readToken();if(b.type!=a.TokenType.Module)throw new a.ParserError(b,"Module 'module' expected.");return b.lexeme.toString()},b.prototype.readClass=function(){var b=this.readToken();if(b.type!=a.TokenType.Class)throw new a.ParserError(b,"Class 'class' expected.")},b.prototype.readFunction=function(){var b=this.readToken();if(b.type!=a.TokenType.Function)throw new a.ParserError(b,"function 'function' expected.")},b.prototype.readCatch=function(){var b=this.readToken();if(b.type!=a.TokenType.Catch)throw new a.ParserError(b,"Catch 'catch' expected.")},b.prototype.getExport=function(){return this.peekToken().type==a.TokenType.Export?(this.readToken(),!0):!1},b.prototype.getAbstract=function(){return this.peekToken().type==a.TokenType.Abstract?(this.readToken(),!0):!1},b}();a.BaseParser=b}(qs||(qs={})),function(a){var b=function(){function b(b){var c,d;for(this.word=null,this.lines=[],this.tokens=[],this._commentList=[],this.commentWord="",this.breviaryLength=20,this.line=0,this.index=0,this._lexType=a.LexType.None,b=b.replace(/\r\n/g,"\n"),c=b.split("\n"),d=0;d<c.length;d++)c[d]+="\n";this.breviary=c[0]||"",this.lines=c}return Object.defineProperty(b.prototype,"commentList",{get:function(){return this._commentList},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"lexType",{get:function(){return this._lexType},set:function(b){this._lexType=b,this._lexType==a.LexType.None&&(this.word="")},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isEndOfLine",{get:function(){return this.index>=this.lines[this.line].length},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"isEndOfBuffer",{get:function(){return this.line>=this.lines.length},enumerable:!0,configurable:!0}),b.prototype.readChar=function(){if(this.isEndOfBuffer)throw new Error("End of source reached.at:"+this.line+":"+this.index);var a=this.lines[this.line].charAt(this.index++);return this.index>=this.lines[this.line].length&&(this.index=0,++this.line),a},b.prototype.ignoreLine=function(){++this.line,this.index=0},b.prototype.addToken=function(b,c){void 0===c&&(c=null),c=null!=c?c:this.char,this.tokens.push(new a.Token(b,c,this.line,this.index)),this.lexType=a.LexType.None},b.prototype.throwInvalidCharacterException=function(a){throw new Error("无效的字符 ["+a+"]  Line:"+(this.line+1)+" Column:"+this.index+" ["+this.lines[this.line]+"]")},b.prototype.addComment=function(){a.Utils.isLetterOrDigit(this.char)||"@"==this.char?this.commentWord+=this.char:(0!=this.commentWord.length&&this._commentList.push(this.commentWord),this.commentWord="")},b.prototype.undoReadChar=function(){if(0==this.line&&0==this.index)throw new Error("Cannot undo char beyond start of source.:"+this.line+":"+this.index);--this.index,this.index<0&&(--this.line,this.index=this.lines[this.line].length-1)},b.prototype.getTokens=function(){var b,c;for(this.line=0,this.index=0,this.lexType=a.LexType.None,this.tokens.length=0;!this.isEndOfBuffer;)if(this.isEndOfLine)this.ignoreLine();else switch(this.char=this.readChar(),this.lexType){case a.LexType.None:switch(this.char){case" ":case"	":case"\n":case"\r":break;case"(":this.addToken(a.TokenType.LeftPar);break;case")":this.addToken(a.TokenType.RightPar);break;case"[":this.addToken(a.TokenType.LeftBracket);break;case"]":this.addToken(a.TokenType.RightBracket);break;case"{":this.addToken(a.TokenType.LeftBrace);break;case"}":this.addToken(a.TokenType.RightBrace);break;case",":this.addToken(a.TokenType.Comma);break;case":":this.addToken(a.TokenType.Colon);break;case";":this.addToken(a.TokenType.SemiColon);break;case"?":this.addToken(a.TokenType.QuestionMark);break;case".":this.lexType=a.LexType.PeriodOrParams;break;case"+":this.lexType=a.LexType.PlusOrIncrementOrAssignPlus;break;case"-":this.lexType=a.LexType.MinusOrDecrementOrAssignMinus;break;case"*":this.lexType=a.LexType.MultiplyOrAssignMultiply;break;case"/":this.lexType=a.LexType.CommentOrDivideOrAssignDivide,this.addComment();break;case"%":this.lexType=a.LexType.ModuloOrAssignModulo;break;case"=":this.lexType=a.LexType.AssignOrEqual;break;case"&":this.lexType=a.LexType.AndOrCombine;break;case"|":this.lexType=a.LexType.OrOrInclusiveOr;break;case"!":this.lexType=a.LexType.NotOrNotEqual;break;case">":this.lexType=a.LexType.GreaterOrGreaterEqual;break;case"<":this.lexType=a.LexType.LessOrLessEqual;break;case"^":this.lexType=a.LexType.XorOrAssignXor;break;case"@":this.lexType=a.LexType.SimpleStringStart;break;case'"':this.lexType=a.LexType.String;break;case"'":this.lexType=a.LexType.SingleString;break;default:"_"==this.char||"$"==this.char||a.Utils.isLetter(this.char)?(this.lexType=a.LexType.Identifier,this.word=""+this.char):"0"==this.char?(this.lexType=a.LexType.NumberOrHexNumber,this.word=""):a.Utils.isDigit(this.char)?(this.lexType=a.LexType.Number,this.word=""+this.char):this.throwInvalidCharacterException(this.char)}break;case a.LexType.PeriodOrParams:"."==this.char?this.lexType=a.LexType.Params:(this.addToken(a.TokenType.Period,"."),this.undoReadChar());break;case a.LexType.Params:"."==this.char?this.addToken(a.TokenType.Params,"..."):this.throwInvalidCharacterException(this.char);break;case a.LexType.PlusOrIncrementOrAssignPlus:"+"==this.char?this.addToken(a.TokenType.Increment,"++"):"="==this.char?this.addToken(a.TokenType.AssignPlus,"+="):(this.addToken(a.TokenType.Plus,"+"),this.undoReadChar());break;case a.LexType.MinusOrDecrementOrAssignMinus:"-"==this.char?this.addToken(a.TokenType.Decrement,"--"):"="==this.char?this.addToken(a.TokenType.AssignMinus,"-="):(this.addToken(a.TokenType.Minus,"-"),this.undoReadChar());break;case a.LexType.MultiplyOrAssignMultiply:"="==this.char?this.addToken(a.TokenType.AssignMultiply,"*="):(this.addToken(a.TokenType.Multiply,"*"),this.undoReadChar());break;case a.LexType.CommentOrDivideOrAssignDivide:switch(this.char){case"/":this.lexType=a.LexType.LineComment,this.addComment();break;case"*":this.lexType=a.LexType.BlockCommentStart,this.addComment();break;case"=":this.addToken(a.TokenType.AssignDivide,"/=");break;default:this.addToken(a.TokenType.Divide,"/"),this.undoReadChar()}break;case a.LexType.ModuloOrAssignModulo:"="==this.char?this.addToken(a.TokenType.AssignModulo,"%="):(this.addToken(a.TokenType.Modulo,"%"),this.undoReadChar());break;case a.LexType.LineComment:"\n"==this.char&&(this.lexType=a.LexType.None);break;case a.LexType.BlockCommentStart:"*"==this.char&&(this.lexType=a.LexType.BlockCommentEnd),this.addComment();break;case a.LexType.BlockCommentEnd:this.lexType="/"==this.char?a.LexType.None:a.LexType.BlockCommentStart,this.addComment();break;case a.LexType.AssignOrEqual:"="==this.char?this.addToken(a.TokenType.Equal,"=="):(this.addToken(a.TokenType.Assign,"="),this.undoReadChar());break;case a.LexType.AndOrCombine:"&"==this.char?this.addToken(a.TokenType.And,"&&"):"="==this.char?this.addToken(a.TokenType.AssignCombine,"&="):(this.addToken(a.TokenType.Combine,"&"),this.undoReadChar());break;case a.LexType.OrOrInclusiveOr:"|"==this.char?this.addToken(a.TokenType.Or,"||"):"="==this.char?this.addToken(a.TokenType.AssignInclusiveOr,"|="):(this.addToken(a.TokenType.InclusiveOr,"|"),this.undoReadChar());break;case a.LexType.XorOrAssignXor:"="==this.char?this.addToken(a.TokenType.AssignXOR,"^="):(this.addToken(a.TokenType.XOR,"^"),this.undoReadChar());break;case a.LexType.GreaterOrGreaterEqual:"="==this.char?this.addToken(a.TokenType.GreaterOrEqual,">="):">"==this.char?this.lexType=a.LexType.ShrOrAssignShr:(this.addToken(a.TokenType.Greater,">"),this.undoReadChar());break;case a.LexType.LessOrLessEqual:"="==this.char?this.addToken(a.TokenType.LessOrEqual,"<="):"<"==this.char?this.lexType=a.LexType.ShiOrAssignShi:(this.addToken(a.TokenType.Less,"<"),this.undoReadChar());break;case a.LexType.ShrOrAssignShr:"="==this.char?this.addToken(a.TokenType.AssignShr,">>="):(this.addToken(a.TokenType.Shr,">>"),this.undoReadChar());break;case a.LexType.ShiOrAssignShi:"="==this.char?this.addToken(a.TokenType.AssignShi,"<<="):(this.addToken(a.TokenType.Shi,"<<"),this.undoReadChar());break;case a.LexType.NotOrNotEqual:"="==this.char?this.addToken(a.TokenType.NotEqual,"!="):(this.addToken(a.TokenType.Not,"!"),this.undoReadChar());break;case a.LexType.String:'"'==this.char?this.addToken(a.TokenType.String,this.word):"\\"==this.char?this.lexType=a.LexType.StringEscape:"\r"==this.char||"\n"==this.char?this.throwInvalidCharacterException(this.char):this.word+=this.char;break;case a.LexType.StringEscape:"\\"==this.char||'"'==this.char?(this.word+=this.char,this.lexType=a.LexType.String):"t"==this.char?(this.word+="	",this.lexType=a.LexType.String):"r"==this.char?(this.word+="\r",this.lexType=a.LexType.String):"n"==this.char?(this.word+="\n",this.lexType=a.LexType.String):this.throwInvalidCharacterException(this.char);break;case a.LexType.SingleString:"'"==this.char?this.addToken(a.TokenType.String,this.word):"\\"==this.char?this.lexType=a.LexType.SingleStringEscape:"\r"==this.char||"\n"==this.char?this.throwInvalidCharacterException(this.char):this.word+=this.char;break;case a.LexType.SingleStringEscape:"\\"==this.char||"'"==this.char?(this.word+=this.char,this.lexType=a.LexType.SingleString):"t"==this.char?(this.word+="	",this.lexType=a.LexType.SingleString):"r"==this.char?(this.word+="\r",this.lexType=a.LexType.SingleString):"n"==this.char?(this.word+="\n",this.lexType=a.LexType.SingleString):this.throwInvalidCharacterException(this.char);break;case a.LexType.SimpleStringStart:'"'==this.char?this.lexType=a.LexType.SimpleString:"'"==this.char?this.lexType=a.LexType.SingleSimpleString:this.throwInvalidCharacterException(this.char);break;case a.LexType.SimpleString:'"'==this.char?this.lexType=a.LexType.SimpleStringQuotationMarkOrOver:this.word+=this.char;break;case a.LexType.SimpleStringQuotationMarkOrOver:'"'==this.char?(this.word+='"',this.lexType=a.LexType.SimpleString):(this.addToken(a.TokenType.String,this.word),this.undoReadChar());break;case a.LexType.SingleSimpleString:"'"==this.char?this.lexType=a.LexType.SingleSimpleStringQuotationMarkOrOver:this.word+=this.char;break;case a.LexType.SingleSimpleStringQuotationMarkOrOver:"'"==this.char?(this.word+="'",this.lexType=a.LexType.SingleSimpleString):(this.addToken(a.TokenType.String,this.word),this.undoReadChar());break;case a.LexType.NumberOrHexNumber:"x"==this.char?this.lexType=a.LexType.HexNumber:(this.word="0",this.lexType=a.LexType.Number,this.undoReadChar());break;case a.LexType.Number:a.Utils.isDigit(this.char)||"."==this.char?this.word+=this.char:(b=parseFloat(this.word),this.addToken(a.TokenType.Number,b),this.undoReadChar());break;case a.LexType.HexNumber:a.Utils.isHexDigit(this.char)?this.word+=this.char:(a.Utils.isNullOrEmpty(this.word)&&this.throwInvalidCharacterException(this.char),b=parseInt("0x"+this.word),this.addToken(a.TokenType.Number,b),this.undoReadChar());break;case a.LexType.Identifier:if("_"==this.char||"$"==this.char||a.Utils.isLetterOrDigit(this.char))this.word+=this.char;else{switch(this.word){case"module":case"namespace":c=a.TokenType.Module;break;case"abstract":c=a.TokenType.Abstract;break;case"export":c=a.TokenType.Export;break;case"class":c=a.TokenType.Class;break;case"interface":c=a.TokenType.Interface;break;case"public":c=a.TokenType.Public;break;case"protected":c=a.TokenType.Protected;break;case"private":c=a.TokenType.Private;break;case"dynamic":c=a.TokenType.Dynamic;break;case"extends":c=a.TokenType.Extends;break;case"override":c=a.TokenType.Override;break;case"void":c=a.TokenType.Void;break;case"NaN":c=a.TokenType.NaN;break;case"import":c=a.TokenType.Import;break;case"static":c=a.TokenType.Static;break;case"get":c=" "==this.char?a.TokenType.Get:a.TokenType.Identifier;break;case"set":c=" "==this.char?a.TokenType.Set:a.TokenType.Identifier;break;case"each":c=a.TokenType.Each;break;case"new":c=a.TokenType.New;break;case"const":c=a.TokenType.Const;break;case"var":c=a.TokenType.Var;break;case"function":c=a.TokenType.Function;break;case"if":c=a.TokenType.If;break;case"else":c=a.TokenType.Else;break;case"while":c=a.TokenType.While;break;case"for":c=a.TokenType.For;break;case"in":c=a.TokenType.In;break;case"switch":c=a.TokenType.Switch;break;case"case":c=a.TokenType.Case;break;case"default":c=a.TokenType.Default;break;case"try":c=a.TokenType.Try;break;case"catch":c=a.TokenType.Catch;break;case"throw":c=a.TokenType.Throw;break;case"continue":c=a.TokenType.Continue;break;case"break":c=a.TokenType.Break;break;case"return":c=a.TokenType.Return;break;case"null":c=a.TokenType.Null;break;case"true":case"false":c=a.TokenType.Boolean;break;case"is":c=a.TokenType.Is;break;case"instanceof":c=a.TokenType.Instanceof;break;case"typeof":c=a.TokenType.Typeof;break;case"delete":c=a.TokenType.Delete;break;case"as":c=a.TokenType.As;break;case"delete":c=a.TokenType.Delete;break;default:c=a.TokenType.Identifier}c==a.TokenType.Boolean?this.tokens.push(new a.Token(c,"true"==this.word,this.line,this.index)):c==a.TokenType.Null?this.tokens.push(new a.Token(c,null,this.line,this.index)):c==a.TokenType.NaN?this.tokens.push(new a.Token(c,0/0,this.line,this.index)):this.tokens.push(new a.Token(c,this.word,this.line,this.index)),this.undoReadChar(),this.lexType=a.LexType.None}}return this.tokens},b}();a.Lexer=b}(qs||(qs={})),function(a){var b;!function(a){a[a["None"]=0]="None",a[a["AssignOrEqual"]=1]="AssignOrEqual",a[a["CommentOrDivideOrAssignDivide"]=2]="CommentOrDivideOrAssignDivide",a[a["LineComment"]=3]="LineComment",a[a["BlockCommentStart"]=4]="BlockCommentStart",a[a["BlockCommentEnd"]=5]="BlockCommentEnd",a[a["PeriodOrParams"]=6]="PeriodOrParams",a[a["Params"]=7]="Params",a[a["PlusOrIncrementOrAssignPlus"]=8]="PlusOrIncrementOrAssignPlus",a[a["MinusOrDecrementOrAssignMinus"]=9]="MinusOrDecrementOrAssignMinus",a[a["MultiplyOrAssignMultiply"]=10]="MultiplyOrAssignMultiply",a[a["ModuloOrAssignModulo"]=11]="ModuloOrAssignModulo",a[a["AndOrCombine"]=12]="AndOrCombine",a[a["OrOrInclusiveOr"]=13]="OrOrInclusiveOr",a[a["XorOrAssignXor"]=14]="XorOrAssignXor",a[a["ShiOrAssignShi"]=15]="ShiOrAssignShi",a[a["ShrOrAssignShr"]=16]="ShrOrAssignShr",a[a["NotOrNotEqual"]=17]="NotOrNotEqual",a[a["GreaterOrGreaterEqual"]=18]="GreaterOrGreaterEqual",a[a["LessOrLessEqual"]=19]="LessOrLessEqual",a[a["String"]=20]="String",a[a["StringEscape"]=21]="StringEscape",a[a["SingleString"]=22]="SingleString",a[a["SingleStringEscape"]=23]="SingleStringEscape",a[a["SimpleStringStart"]=24]="SimpleStringStart",a[a["SimpleString"]=25]="SimpleString",a[a["SimpleStringQuotationMarkOrOver"]=26]="SimpleStringQuotationMarkOrOver",a[a["SingleSimpleString"]=27]="SingleSimpleString",a[a["SingleSimpleStringQuotationMarkOrOver"]=28]="SingleSimpleStringQuotationMarkOrOver",a[a["NumberOrHexNumber"]=29]="NumberOrHexNumber",a[a["Number"]=30]="Number",a[a["HexNumber"]=31]="HexNumber",a[a["Identifier"]=32]="Identifier"}(b=a.LexType||(a.LexType={}))}(qs||(qs={})),function(a){var b=function(b){function c(a,c){var d=b.call(this,a)||this;return d.classPathMap={},d.codeClassList=[],d.globalObj=c,d.parse(),d}return __extends(c,b),c.prototype.parse=function(){for(;this.hasMoreTokens();)this._parse();return this.classPathMap},c.prototype._parse=function(){var c,b=this.parseModule();for(b&&this.readLeftBrace();;)if(c=new a.CodeClass,c.owner=b,this.parseClass(c),!this.hasMoreTokens()||c.owner&&this.peekToken().type==a.TokenType.RightBrace)break;return b&&this.readRightBrace(),c},c.prototype.parseModule=function(){var c,d,e,b=null;if(this.peekToken().type==a.TokenType.Module)for(this.readModule(),c=this.readIdentifier(),b=new a.CodeModule(this.peekToken()),d=this.classPathMap[c]||{},this.classPathMap[c]=d,b.value=c,b.classPathMap=d;this.peekToken().type==a.TokenType.Period;)this.readToken(),c=this.readIdentifier(),e=new a.CodeModule(this.peekToken()),e.value=c,e.parent=b,b=e,d=d[c]=d[c]||{},b.classPathMap=d;return b},c.prototype.parseClass=function(a){this.getExport(),this.getAbstract(),this.readClass(),a.name=this.readIdentifier(),a.owner?a.owner.classPathMap[a.name]=a:this.classPathMap[a.name]=a,this.codeClassList.push(a),this.readExtend(a),this.readMembers(a)},c.prototype.readMembers=function(b){var c,d,e,f,g,h,i,j;for(void 0===b&&(b=null),this.readLeftBrace();this.peekToken().type!=a.TokenType.RightBrace;)c=this.peekToken(),d=!1,e=!1,f=!1,g=a.TokenType.Public,(c.type==a.TokenType.Public||c.type==a.TokenType.Private||c.type==a.TokenType.Protected)&&(g=c.type,this.readToken(),c=this.peekToken()),c.type==a.TokenType.Static&&(this.readToken(),d=!0),c.type==a.TokenType.Get&&(this.readToken(),e=!0),c.type==a.TokenType.Set&&(this.readToken(),f=!0),h=this.readToken().lexeme,this.peekToken().type==a.TokenType.LeftPar?(this.undoToken(),this.undoToken(),b.addFunction(this.parseFunctionDeclaration(g,d))):(i=null,this.peekToken().type==a.TokenType.Colon&&(b.isObject?(this.readToken(),i=this.getObject()):(this.readToken(),i=this.getOneObject(!0))),this.peekToken().type==a.TokenType.Assign?(this.readToken(),c=this.peekToken(),c.type==a.TokenType.New?(c=this.readToken(),b.addVariable(new a.CodeVariable(h,this.getNew(),g,d,i,c))):b.addVariable(new a.CodeVariable(h,this.getObject(),g,d,i,c))):b.name?b.addVariable(new a.CodeVariable(h,void 0,g,d,i,c)):b.addVariable(new a.CodeVariable(h,i||h,g,d,i,c))),j=this.peekToken(),(j.type==a.TokenType.Comma||j.type==a.TokenType.SemiColon)&&this.readToken();this.readRightBrace()},c.prototype.parseStatementBlock=function(b,c,d){void 0===c&&(c=!0),void 0===d&&(d=a.TokenType.RightBrace),c&&this.readLeftBrace();for(var e;this.hasMoreTokens()&&(e=this.readToken().type,e!=d);)this.undoToken(),this.parseStatement(b)},c.prototype.parseStatement=function(b){var d,c=this.readToken();switch(c.type){case a.TokenType.Public:throw new a.ParserError(c,"方法内的声明不支持public ");case a.TokenType.Protected:throw new a.ParserError(c,"方法内的声明不支持protected ");case a.TokenType.Private:throw new a.ParserError(c,"方法内的声明不支持private ");case a.TokenType.Var:this.parseVar(b);break;case a.TokenType.If:this.parseIf(b);break;case a.TokenType.For:this.parseFor(b);break;case a.TokenType.While:this.parseWhile(b);break;case a.TokenType.Switch:this.parseSwtich(b);break;case a.TokenType.Try:this.parseTry(b);break;case a.TokenType.Throw:this.parseThrow(b);break;case a.TokenType.Return:this.parseReturn(b);break;case a.TokenType.Identifier:case a.TokenType.Increment:case a.TokenType.Decrement:this.parseExpression(b);break;case a.TokenType.New:this.getNew(b);break;case a.TokenType.Typeof:this.getTypeof(b);break;case a.TokenType.Delete:this.getDelete(b);break;case a.TokenType.Break:b.addInstruction(new a.Instruction(a.Opcode.BREAK,new a.CodeObject(c),c));break;case a.TokenType.Continue:b.addInstruction(new a.Instruction(a.Opcode.CONTINUE,new a.CodeObject(c),c));break;case a.TokenType.Function:d=this.parseFunction(),d.autoCall&&b.addInstruction(new a.Instruction(a.Opcode.CALL_FUNCTION,d,c));break;case a.TokenType.SemiColon:break;case a.TokenType.LeftPar:this.parseStatementBlock(b,!1,a.TokenType.RightPar);break;case a.TokenType.As:this.getObject();break;default:throw new a.ParserError(c,"不支持的语法 ")}},c.prototype.parseVar=function(b){for(;;){b.addInstruction(new a.Instruction(a.Opcode.VAR,this.readIdentifier(),this.peekToken()));var c=this.peekToken();if(c.type==a.TokenType.Colon&&(this.readToken(),this.readToken(),c=this.peekToken()),c.type==a.TokenType.Assign&&(this.undoToken(),this.undoToken(),this.peekToken().type==a.TokenType.Colon?this.undoToken():this.readToken(),this.parseStatement(b)),c=this.readToken(),c.type!=a.TokenType.Comma){this.undoToken();break}}},c.prototype.parseIf=function(b){var d,c=new a.CodeIf;for(c.If=this.parseCondition(!0,new a.Executable(a.BlockType.If,b));;){if(d=this.readToken(),d.type!=a.TokenType.Else){this.undoToken();break}if(this.peekToken().type!=a.TokenType.If){this.undoToken();break}this.readToken(),c.addElseIf(this.parseCondition(!0,new a.Executable(a.BlockType.If,b)))}this.peekToken().type==a.TokenType.Else&&(this.readToken(),c.Else=this.parseCondition(!1,new a.Executable(a.BlockType.If,b))),b.addInstruction(new a.Instruction(a.Opcode.CALL_IF,c,this.peekToken()))},c.prototype.parseCondition=function(b,c){var d=null;return b&&(this.readLeftParenthesis(),d=this.getObject(),this.readRightParenthesis()),this.parseStatementBlock(c),new a.TempCondition(d,c)},c.prototype.parseFor=function(b){var c,d,e,f,g;if(this.readToken(),this.readToken(),this.readToken(),this.peekToken().type==a.TokenType.In)this.undoToken(),this.undoToken(),this.undoToken(),this.parseForeach(b);else{if(this.undoToken(),this.undoToken(),this.undoToken(),this.readLeftParenthesis(),c=this.index,d=this.readToken(),d.type==a.TokenType.Identifier&&(e=this.readToken(),e.type==a.TokenType.Assign&&(f=this.getObject(),g=this.readToken(),g.type==a.TokenType.Comma)))return this.parseFor_Simple(b,d.lexeme+"",f),void 0;this.index=c,this.parseFor_impl(b)}},c.prototype.parseFor_Simple=function(b,c,d){var f,e=new a.CodeForSimple;e.identifier=c,e.begin=d,e.finished=this.getObject(),this.peekToken().type==a.TokenType.Comma&&(this.readToken(),e.step=this.getObject()),this.readRightParenthesis(),f=new a.Executable(a.BlockType.For,b),this.parseStatementBlock(f),e.setContextExecutable(f),b.addInstruction(new a.Instruction(a.Opcode.CALL_FORSIMPLE,e,this.peekToken()))},c.prototype.parseFor_impl=function(b){var e,f,g,c=new a.CodeFor,d=this.readToken();d.type!=a.TokenType.SemiColon&&(this.undoToken(),e=new a.Executable(a.BlockType.ForBegin,b),this.parseStatementBlock(e,!1,a.TokenType.SemiColon),c.beginExecutable=e),d=this.readToken(),d.type!=a.TokenType.SemiColon&&(this.undoToken(),c.condition=this.getObject(),this.readSemiColon()),d=this.readToken(),d.type!=a.TokenType.RightPar&&(this.undoToken(),f=new a.Executable(a.BlockType.ForLoop,b),this.parseStatementBlock(f,!1,a.TokenType.RightPar),c.loopExecutable=f),g=new a.Executable(a.BlockType.For,b),this.parseStatementBlock(g),c.setContextExecutable(g),b.addInstruction(new a.Instruction(a.Opcode.CALL_FOR,c,this.peekToken()))
},c.prototype.parseForeach=function(b){var d,c=new a.CodeForIn;this.readLeftParenthesis(),this.readVar(),c.identifier=this.readIdentifier(),this.peekToken().type==a.TokenType.Colon&&(this.readColon(),this.readIdentifier()),this.readIn(),c.loopObject=this.getObject(),this.readRightParenthesis(),d=new a.Executable(a.BlockType.Forin,b),this.parseStatementBlock(d),c.executable=d,b.addInstruction(new a.Instruction(a.Opcode.CALL_FORIN,c,this.peekToken()))},c.prototype.parseWhile=function(b){var c=new a.CodeWhile;c.while=this.parseCondition(!0,new a.Executable(a.BlockType.While,b)),b.addInstruction(new a.Instruction(a.Opcode.CALL_WHILE,c,this.peekToken()))},c.prototype.parseSwtich=function(b){var d,e,f,c=new a.CodeSwitch;for(this.readLeftParenthesis(),c.condition=this.getObject(),this.readRightParenthesis(),this.readLeftBrace();;)if(d=this.readToken(),d.type==a.TokenType.Case)e=[],this.parseCase(e),f=new a.Executable(a.BlockType.Switch,b),this.parseStatementBlock(f,!1,a.TokenType.Break),c.addCase(new a.TempCase(e,f));else if(d.type==a.TokenType.Default)this.readColon(),f=new a.Executable(a.BlockType.Switch,b),this.parseStatementBlock(f,!1,a.TokenType.Break),c.default=new a.TempCase(null,f);else if(d.type!=a.TokenType.SemiColon){this.undoToken();break}this.readRightBrace(),b.addInstruction(new a.Instruction(a.Opcode.CALL_SWITCH,c,this.peekToken()))},c.prototype.parseCase=function(b){b.push(this.getObject(!1)),this.readColon(),this.readToken().type==a.TokenType.Case?this.parseCase(b):this.undoToken()},c.prototype.parseTry=function(b){var e,c=new a.CodeTry,d=new a.Executable(a.BlockType.Function,b);this.parseStatementBlock(d),c.tryExecutable=d,this.readCatch(),this.readLeftParenthesis(),c.identifier=this.readIdentifier(),e=this.peekToken(),e.type==a.TokenType.Colon&&(this.readToken(),this.readToken(),e=this.peekToken()),this.readRightParenthesis(),d=new a.Executable(a.BlockType.Function,b),this.parseStatementBlock(d),c.catchExecutable=d,b.addInstruction(new a.Instruction(a.Opcode.CALL_TRY,c,this.peekToken()))},c.prototype.parseThrow=function(b){var c=new a.CodeThrow;c.obj=this.getObject(),b.addInstruction(new a.Instruction(a.Opcode.THROW,c,this.peekToken()))},c.prototype.parseReturn=function(b){var c=this.peekToken();c.type==a.TokenType.RightBrace||c.type==a.TokenType.SemiColon?b.addInstruction(new a.Instruction(a.Opcode.RET,null,this.peekToken())):b.addInstruction(new a.Instruction(a.Opcode.RET,this.getObject(),this.peekToken()))},c.prototype.parseExpression=function(b){var c,d;if(this.undoToken(),c=this.peekToken(),d=this.getObject(),d instanceof a.CodeCallFunction)b.addInstruction(new a.Instruction(a.Opcode.CALL_FUNCTION,d,c));else if(d instanceof a.CodeMember)d.calc!=a.Calc.NONE&&b.addInstruction(new a.Instruction(a.Opcode.RESOLVE,d,c));else if(d instanceof a.CodeAssign)b.addInstruction(new a.Instruction(a.Opcode.RESOLVE,d,c));else{if(!(d instanceof a.CodeOperator))throw new a.ParserError(c,"语法不支持起始符号为 "+c.lexeme);b.addInstruction(new a.Instruction(a.Opcode.RESOLVE,d,c))}},c.prototype.getOneObject=function(b){var c,d,e,f,g,h;switch(void 0===b&&(b=!1),c=null,d=this.readToken(),e=!1,f=!1,g=!1,h=a.Calc.NONE,d.type==a.TokenType.Not?(e=!0,d=this.readToken(),d.type==a.TokenType.Not&&(e=!1,f=!0,d=this.readToken())):d.type==a.TokenType.Minus?(g=!0,d=this.readToken()):d.type==a.TokenType.Increment?(h=a.Calc.PRE_INCREMENT,d=this.readToken()):d.type==a.TokenType.Decrement&&(h=a.Calc.PRE_DECREMENT,d=this.readToken()),d.type){case a.TokenType.Identifier:c=new a.CodeMember(d.lexeme,d);break;case a.TokenType.LeftPar:if(b){for(d=this.peekToken();d.type!=a.TokenType.Assign;)d=this.readToken();this.readGreater(),this.getOneObject(),c=Function}else c=this.getObject(),this.readRightParenthesis();break;case a.TokenType.Function:c=this.parseFunction();break;case a.TokenType.LeftBracket:this.undoToken(),c=this.getArray();break;case a.TokenType.LeftBrace:this.undoToken(),c=new a.CodeClass,c.isObject=!0,this.readMembers(c);break;case a.TokenType.Void:case a.TokenType.Null:case a.TokenType.NaN:case a.TokenType.Boolean:case a.TokenType.Number:case a.TokenType.String:c=new a.CodeScriptObject(d.lexeme,d);break;case a.TokenType.New:c=this.getNew();break;case a.TokenType.Typeof:c=this.getTypeof();break;case a.TokenType.Delete:c=this.getDelete();break;default:throw new a.ParserError(d,"Object起始关键字错误 ")}if(c=this.getVariable(c),c.not=e,c.doubleNot=f,c.negative=g,c instanceof a.CodeMember)h!=a.Calc.NONE?c.calc=h:(d=this.readToken(),d.type==a.TokenType.Increment?h=a.Calc.POST_INCREMENT:d.type==a.TokenType.Decrement?h=a.Calc.POST_DECREMENT:this.undoToken(),h!=a.Calc.NONE&&(c.calc=h));else if(h!=a.Calc.NONE)throw new a.ParserError(d,"++ 或者 -- 只支持变量的操作");return c},c.prototype.parseFunction=function(){return this.parseFunctionDeclaration()},c.prototype.parseFunctionDeclaration=function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o;if(void 0===b&&(b=a.TokenType.Public),void 0===c&&(c=!1),d=this.readToken(),e=a.FunctionType.Normal,d.type==a.TokenType.Get&&(e=a.FunctionType.Get),d.type==a.TokenType.Set&&(e=a.FunctionType.Set),f=null,d.type!=a.TokenType.LeftPar&&this.peekToken().type!=a.TokenType.RightPar&&(f=this.readIdentifier(),f=e==a.FunctionType.Get?".get."+f:f,f=e==a.FunctionType.Set?".set."+f:f),d.type!=a.TokenType.LeftPar&&this.readLeftParenthesis(),g=[],h=[],i=[],j=!1,this.peekToken().type!=a.TokenType.RightPar)for(;;){if(d=this.readToken(),d.type==a.TokenType.Params&&(d=this.readToken(),j=!0),d.type!=a.TokenType.Identifier)throw new a.ParserError(d,"Unexpected token '"+d.lexeme+"' in function declaration.");if(k=d.lexeme.toString(),d=this.peekToken(),d.type==a.TokenType.QuestionMark&&this.readToken(),d.type==a.TokenType.Colon?(this.readColon(),l=this.getObject(),l instanceof a.CodeAssign?(h.push(l.member),i.push(l.value)):(h.push(l),i.push(void 0))):d.type==a.TokenType.Assign?(this.undoToken(),m=this.getObject(),i.push(m.value)):(h.push(null),i.push(void 0)),g.push(k),d=this.peekToken(),d.type!=a.TokenType.Comma||j){if(d.type==a.TokenType.RightPar)break;throw new a.ParserError(d,"Comma ',' or right parenthesis ')' expected in function declararion.")}this.readComma()}return this.readRightParenthesis(),d=this.readToken(),d.type==a.TokenType.Colon?this.getObject():this.undoToken(),n=new a.Executable(a.BlockType.Function),this.parseStatementBlock(n),o=new a.CodeFunction(f,c,g,h,i,n,j,d),d=this.readToken(),this.undoToken(),d.type==a.TokenType.LeftPar&&(o.parameters=this.getCallFunction(null).parameters,o.autoCall=!0),o},c.prototype.getTernary=function(b){if(this.peekToken().type==a.TokenType.QuestionMark){var c=new a.CodeTernary;return c.allow=b,this.readToken(),c.true=this.getObject(!1),this.readColon(),c.false=this.getObject(!1),c}return b},c.prototype.getArray=function(){var b,c;for(this.readLeftBracket(),b=this.peekToken(),c=new a.CodeArray;b.type!=a.TokenType.RightBracket&&this.peekToken().type!=a.TokenType.RightBracket;){if(c.elements.push(this.getObject()),b=this.peekToken(),b.type!=a.TokenType.Comma){if(b.type==a.TokenType.RightBracket)break;throw new a.ParserError(b,"Comma ',' or right parenthesis ']' expected in array object.")}this.readComma()}return this.readRightBracket(),c},c.prototype.getNew=function(b){void 0===b&&(b=null);var c=new a.CodeNew(this.getObject(),this.peekToken());return null!=b&&b.addInstruction(new a.Instruction(a.Opcode.NEW,c,this.peekToken())),c},c.prototype.getTypeof=function(b){void 0===b&&(b=null);var c=new a.CodeTypeof(this.getObject(),this.peekToken());return null!=b&&b.addInstruction(new a.Instruction(a.Opcode.Typeof,c,this.peekToken())),c},c.prototype.getDelete=function(b){void 0===b&&(b=null);var c=new a.CodeDelete(this.getObject(),this.peekToken());return null!=b&&b.addInstruction(new a.Instruction(a.Opcode.Delete,c,this.peekToken())),c},c.prototype.getVariable=function(b){for(var d,e,f,c=b;;)if(d=this.readToken(),d.type==a.TokenType.Period){if(e=this.readIdentifier(),c=new a.CodeMember(e,this.peekToken(),c),this.peekToken().type==a.TokenType.LeftBracket){if(this.readToken(),this.peekToken().type==a.TokenType.RightBracket)return this.readToken(),c;this.undoToken()}}else if(d.type==a.TokenType.LeftBracket)f=this.getObject(),c=new a.CodeMember(f,this.peekToken(),c),this.peekToken().type==a.TokenType.RightBracket&&this.readRightBracket();else{if(d.type!=a.TokenType.LeftPar){this.undoToken();break}this.undoToken(),c=this.getCallFunction(c)}return c},c.prototype.getObject=function(b){var c,d,e,f,g,h,i;for(void 0===b&&(b=!0),c=new a.Stack,d=new a.Stack;;)if(d.push(this.getOneObject()),!this.parseOperator(c,d))break;for(;;){if(c.length<=0)break;e=c.pop(),f=new a.CodeOperator(d.pop(),d.pop(),e.operator,this.peekToken()),d.push(f)}if(g=d.pop(),g instanceof a.CodeMember&&(h=g,h.calc==a.Calc.NONE))switch(i=this.readToken(),i.type==a.TokenType.Colon&&b&&(this.readToken(),i=this.readToken()),i.type){case a.TokenType.Assign:case a.TokenType.AssignPlus:case a.TokenType.AssignMinus:case a.TokenType.AssignMultiply:case a.TokenType.AssignDivide:case a.TokenType.AssignModulo:case a.TokenType.AssignCombine:case a.TokenType.AssignInclusiveOr:case a.TokenType.AssignXOR:case a.TokenType.AssignShr:case a.TokenType.AssignShi:return new a.CodeAssign(h,this.getObject(),i.type,i);default:this.undoToken()}return g=this.getTernary(g)},c.prototype.parseOperator=function(b,c){var e,f,d=a.TempOperator.getOper(this.peekToken().type);if(null==d)return!1;for(this.readToken();b.length>0&&(e=b.peek(),e.level>=d.level);)b.pop(),f=new a.CodeOperator(c.pop(),c.pop(),e.operator,this.peekToken()),c.push(f);return b.push(d),!0},c.prototype.getCallFunction=function(b){var d,e,c=new a.CodeCallFunction(this.peekToken());for(this.readLeftParenthesis(),d=[],e=this.peekToken();e.type!=a.TokenType.RightPar;){if(d.push(this.getObject()),e=this.peekToken(),e.type!=a.TokenType.Comma){if(e.type==a.TokenType.RightPar)break;throw new a.ParserError(e,"Comma ',' or right parenthesis ')' expected in function declararion.")}this.readComma()}return this.readRightParenthesis(),c.member=b,c.parameters=d,c},c.prototype.readExtend=function(b){this.peekToken().type==a.TokenType.Extends&&(this.readToken(),b.parent=this.getCodeClass(b.owner))},c.prototype.getCodeClass=function(b){var c=this.readIdentifier(),d=null;if(this.peekToken().type==a.TokenType.Period)for(d=this.getCodeClassByName(c);this.peekToken().type==a.TokenType.Period;){if(!d)throw this.undoToken(),new a.ParserError(this.peekToken(),"不存在的定义 "+c);if(this.readToken(),c=this.readIdentifier(),this.peekToken().type!=a.TokenType.Period)return this.getCodeClassByName(c,d);d=this.getCodeClassByName(c,d)}else if(d=this.getCodeClassByName(c),!d)for(;b&&!d;)d=b.classPathMap[c],b=b.parent;return d},c.prototype.getCodeClassByName=function(a,b){return void 0===b&&(b=null),null==b?this.classPathMap[a]||this.globalObj[a]:b[a]},c}(a.BaseParser);a.Parser=b}(qs||(qs={})),function(a){var b=function(){function b(a,b,c,d){this._type=a,this._lexeme=b,this._line=c,this._index=d}return Object.defineProperty(b.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"name",{get:function(){return a.TokenType[this.type]},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"lexeme",{get:function(){return this._lexeme},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"line",{get:function(){return this._line},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),b.prototype.toString=function(){return this.name+":"+this._lexeme.toString()},b}();a.Token=b}(qs||(qs={})),function(a){var b;!function(a){a[a["None"]=0]="None",a[a["Var"]=1]="Var",a[a["Const"]=2]="Const",a[a["LeftBrace"]=3]="LeftBrace",a[a["RightBrace"]=4]="RightBrace",a[a["LeftPar"]=5]="LeftPar",a[a["RightPar"]=6]="RightPar",a[a["LeftBracket"]=7]="LeftBracket",a[a["RightBracket"]=8]="RightBracket",a[a["Period"]=9]="Period",a[a["Comma"]=10]="Comma",a[a["Colon"]=11]="Colon",a[a["SemiColon"]=12]="SemiColon",a[a["QuestionMark"]=13]="QuestionMark",a[a["Plus"]=14]="Plus",a[a["Increment"]=15]="Increment",a[a["AssignPlus"]=16]="AssignPlus",a[a["Minus"]=17]="Minus",a[a["Decrement"]=18]="Decrement",a[a["AssignMinus"]=19]="AssignMinus",a[a["Multiply"]=20]="Multiply",a[a["AssignMultiply"]=21]="AssignMultiply",a[a["Divide"]=22]="Divide",a[a["AssignDivide"]=23]="AssignDivide",a[a["Modulo"]=24]="Modulo",a[a["AssignModulo"]=25]="AssignModulo",a[a["InclusiveOr"]=26]="InclusiveOr",a[a["AssignInclusiveOr"]=27]="AssignInclusiveOr",a[a["Or"]=28]="Or",a[a["Combine"]=29]="Combine",a[a["AssignCombine"]=30]="AssignCombine",a[a["And"]=31]="And",a[a["XOR"]=32]="XOR",a[a["AssignXOR"]=33]="AssignXOR",a[a["Shi"]=34]="Shi",a[a["AssignShi"]=35]="AssignShi",a[a["Shr"]=36]="Shr",a[a["AssignShr"]=37]="AssignShr",a[a["Not"]=38]="Not",a[a["Assign"]=39]="Assign",a[a["Equal"]=40]="Equal",a[a["Instanceof"]=41]="Instanceof",a[a["Typeof"]=42]="Typeof",a[a["NotEqual"]=43]="NotEqual",a[a["Greater"]=44]="Greater",a[a["GreaterOrEqual"]=45]="GreaterOrEqual",a[a["Less"]=46]="Less",a[a["LessOrEqual"]=47]="LessOrEqual",a[a["Params"]=48]="Params",a[a["If"]=49]="If",a[a["Else"]=50]="Else",a[a["For"]=51]="For",a[a["Dynamic"]=52]="Dynamic",a[a["Each"]=53]="Each",a[a["In"]=54]="In",a[a["Switch"]=55]="Switch",a[a["Case"]=56]="Case",a[a["Default"]=57]="Default",a[a["Break"]=58]="Break",a[a["Continue"]=59]="Continue",a[a["Return"]=60]="Return",a[a["While"]=61]="While",a[a["Function"]=62]="Function",a[a["Try"]=63]="Try",a[a["Catch"]=64]="Catch",a[a["Throw"]=65]="Throw",a[a["Boolean"]=66]="Boolean",a[a["Number"]=67]="Number",a[a["String"]=68]="String",a[a["Null"]=69]="Null",a[a["Export"]=70]="Export",a[a["Abstract"]=71]="Abstract",a[a["NameSpace"]=72]="NameSpace",a[a["Module"]=73]="Module",a[a["Class"]=74]="Class",a[a["Interface"]=75]="Interface",a[a["Public"]=76]="Public",a[a["Protected"]=77]="Protected",a[a["Private"]=78]="Private",a[a["Extends"]=79]="Extends",a[a["Static"]=80]="Static",a[a["Override"]=81]="Override",a[a["New"]=82]="New",a[a["Void"]=83]="Void",a[a["NaN"]=84]="NaN",a[a["Import"]=85]="Import",a[a["Get"]=86]="Get",a[a["Set"]=87]="Set",a[a["Identifier"]=88]="Identifier",a[a["Is"]=89]="Is",a[a["As"]=90]="As",a[a["Delete"]=91]="Delete"}(b=a.TokenType||(a.TokenType={}))}(qs||(qs={})),function(a){var c,b=function(){function a(a,b){void 0===b&&(b=null),this.instructionList=[],this.type=a,this.parent=b}return a.prototype.addInstruction=function(a){this.instructionList.push(a)},a}();a.Executable=b,function(a){a[a["None"]=0]="None",a[a["Block"]=1]="Block",a[a["Function"]=2]="Function",a[a["If"]=3]="If",a[a["ForBegin"]=4]="ForBegin",a[a["ForLoop"]=5]="ForLoop",a[a["For"]=6]="For",a[a["Forin"]=7]="Forin",a[a["While"]=8]="While",a[a["Switch"]=9]="Switch"}(c=a.BlockType||(a.BlockType={}))}(qs||(qs={})),function(a){var b=function(){function a(a,b,c){this._opcode=a,this._value=b,this.token=c}return Object.defineProperty(a.prototype,"opcode",{get:function(){return this._opcode},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0}),a}();a.Instruction=b}(qs||(qs={})),function(a){var b;!function(a){a[a["VAR"]=0]="VAR",a[a["CALL_IF"]=1]="CALL_IF",a[a["CALL_FOR"]=2]="CALL_FOR",a[a["CALL_FORSIMPLE"]=3]="CALL_FORSIMPLE",a[a["CALL_FORIN"]=4]="CALL_FORIN",a[a["CALL_WHILE"]=5]="CALL_WHILE",a[a["CALL_SWITCH"]=6]="CALL_SWITCH",a[a["CALL_TRY"]=7]="CALL_TRY",a[a["CALL_FUNCTION"]=8]="CALL_FUNCTION",a[a["THROW"]=9]="THROW",a[a["RESOLVE"]=10]="RESOLVE",a[a["RET"]=11]="RET",a[a["BREAK"]=12]="BREAK",a[a["CONTINUE"]=13]="CONTINUE",a[a["NEW"]=14]="NEW",a[a["Typeof"]=15]="Typeof",a[a["Delete"]=16]="Delete"}(b=a.Opcode||(a.Opcode={}))}(qs||(qs={})),__extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},function(a){var b=function(){function b(){}return b.prototype.run=function(a,b){var c,d,e,f;for(this.parser=b,d=0;d<b.codeClassList.length;d++)e=b.codeClassList[d],f=this.parseClass(e),a==e&&(c=f);return c},b.prototype.parseClass=function(b){var c,d,e,f,g,h,i;for(this.codeClass=b,c=this.parser.globalObj,d=this.getPathList(b),d.pop(),e=0;e<d.length;e++)c[d[e]]=c[d[e]]||{},c=c[d[e]];return f=null,b.parent instanceof a.CodeObject?(g=this.codeClass,f=this.parseClass(b.parent),this.codeClass=g):f=b.parent,h=this,i=c[b.name]=function(c){function e(){var e,f,g,i;if(this[".classPath"]=h.getClassPath(d),this[".super"]=c,e=arguments,f=d.getFunction("constructor"))return h.callConstructor(b.variableMap,f,this,c,e);g=c&&c.apply(this,arguments)||this,h.currentThis=g;for(i in b.variableMap)this[i]=h.resolveOperand(b.variableMap[i].value,{value:void 0,isOver:!1,isContinue:!1,isBreak:!1,blockType:a.BlockType.Function,parent:null,context:g});return g}var g,i,j,k,d=b;!!f&&__extends(e,c);for(g in b.functionMap)"constructor"!=g&&(i=g.substring(0,5),".get."==i?(j=g.substr(5),Object.defineProperty(e.prototype,j,{get:h.resolveOperand(b.functionMap[g],{value:void 0,isOver:!1,isContinue:!1,isBreak:!1,blockType:a.BlockType.Function,parent:null,context:{}}),enumerable:!0,configurable:!0})):".set."==i?(k=g.substr(5),Object.defineProperty(e.prototype,k,{set:h.resolveOperand(b.functionMap[g],{value:void 0,isOver:!1,isContinue:!1,isBreak:!1,blockType:a.BlockType.Function,parent:null,context:{}}),enumerable:!0,configurable:!0})):e.prototype[g]=h.resolveOperand(b.functionMap[g],{value:void 0,isOver:!1,isContinue:!1,isBreak:!1,blockType:a.BlockType.Function,parent:null,context:{}}));for(g in b.variableMap_static)e[g]=h.resolveOperand(b.variableMap_static[g].value,{value:void 0,isOver:!1,isContinue:!1,isBreak:!1,blockType:a.BlockType.Function,parent:null,context:{}});for(g in b.functionMap_static)e[g]=h.resolveOperand(b.functionMap_static[g],{value:void 0,isOver:!1,isContinue:!1,isBreak:!1,blockType:a.BlockType.Function,parent:null,context:{}});return e}(f)},b.prototype.callConstructor=function(b,c,d,e,f){var i,g=c.executable.instructionList,h=this.currentThis=d;if(e&&"super"!=g[0].token.lexeme)throw new a.ExecutionError(c.token,"构造函数里面缺少super");"super"==g[0].token.lexeme&&g[0].opcode==a.Opcode.CALL_FUNCTION&&(h=this.currentThis=e&&e.call(d,f)||d);for(i in b)h[i]=this.resolveOperand(b[i].value,{value:void 0,isOver:!1,isContinue:!1,isBreak:!1,blockType:a.BlockType.Function,parent:null,context:h});return this.parseExecutable(c,null,h)(),h},b.prototype.parseExecutable=function(b,c,d){var e,f;return void 0===d&&(d=null),e=this,f=function(){function j(){var b,d;for(e.currentThis=this,b=0;b<g.length;b++)j[g[b]]=arguments[b]||e.resolveOperand(h[b],c);return d={value:void 0,isOver:!1,isContinue:!1,isBreak:!1,blockType:a.BlockType.Function,parent:c,context:j},e.executable(f,d),d.value}var f=b.executable,g=b.paramNames,h=b.values;return j}(),d?f.bind(d):f},b.prototype.executable=function(a,b){for(var c=0;c<a.instructionList.length&&(this.exeInstruction(a.instructionList[c],b),!(b.isOver||b.isContinue||b.isBreak));c++);},b.prototype.exeInstruction=function(b,c){var d=b.opcode;switch(d){case a.Opcode.VAR:this.processVar(b,c);break;case a.Opcode.RET:this.processReturn(b,c);break;case a.Opcode.RESOLVE:this.processResolve(b,c);break;case a.Opcode.CONTINUE:this.processContinue(b,c);break;case a.Opcode.BREAK:this.processBreak(b,c);break;case a.Opcode.CALL_FUNCTION:this.processCallFunction(b,c);break;case a.Opcode.CALL_IF:this.processCallIf(b,c);break;case a.Opcode.CALL_FOR:this.processCallFor(b,c);break;case a.Opcode.CALL_FORIN:this.processCallForIn(b,c);break;case a.Opcode.CALL_FORSIMPLE:this.processCallForSimple(b,c);break;case a.Opcode.CALL_WHILE:this.processCallWhile(b,c);break;case a.Opcode.CALL_SWITCH:this.processCallSwitch(b,c);break;case a.Opcode.CALL_TRY:this.processTry(b,c);break;case a.Opcode.THROW:this.processThrow(b,c);break;case a.Opcode.NEW:this.processNew(b,c);break;case a.Opcode.Typeof:this.processTypeof(b,c);break;case a.Opcode.Delete:this.processDelete(b,c)}},b.prototype.processBreak=function(a,b){this.invokeBreak(a.value,b)},b.prototype.invokeBreak=function(b,c){if(c.isBreak=!0,!this.isSupportBreak(c.blockType)){if(null==c.parent)throw new a.ExecutionError(b.token,"this block is not support continue");this.invokeBreak(b,c.parent)}},b.prototype.processContinue=function(a,b){this.invokeContinue(a.value,b)},b.prototype.invokeContinue=function(b,c){if(c.isContinue=!0,!this.isSupportContinue(c.blockType)){if(null==c.parent)throw new a.ExecutionError(b.token,"this block is not support continue");this.invokeContinue(b,c.parent)}},b.prototype.processCallFor=function(b,c){var f,d=b.value,e={value:void 0,isOver:!1,isContinue:!1,isBreak:!1,blockType:a.BlockType.For,parent:c,context:{}};for(this.executable(d.beginExecutable,e);(null==d.condition||(f=this.resolveOperand(d.condition,e),f))&&(this.executable(d.blockExecutable,e),!e.isBreak)&&!e.isOver;)this.executable(d.loopExecutable,e),!e.isContinue},b.prototype.processCallForIn=function(b,c){var f,g,h,d=b.value,e=this.resolveOperand(d.loopObject,c);for(f in e){if(null==e)return;if(g={},g[d.identifier]=f,h={value:void 0,isOver:!1,isContinue:!1,isBreak:!1,blockType:a.BlockType.Forin,parent:c,context:g},h.isBreak)break;if(h.isOver)break;this.executable(d.executable,h),!h.isContinue}},b.prototype.processCallWhile=function(b,c){for(var f,d=b.value,e=d.while;(f={value:void 0,isOver:!1,isContinue:!1,isBreak:!1,blockType:a.BlockType.While,parent:c,context:{}},this.processCondition(e,a.BlockType.While,f))&&!c.isBreak&&!c.isOver;)!c.isContinue},b.prototype.processCallSwitch=function(b,c){var h,i,j,k,l,d=b.value,e=this.resolveOperand(d.condition,c),f=!1,g={value:void 0,isOver:!1,isContinue:!1,isBreak:!1,blockType:a.BlockType.Switch,parent:c,context:{}};for(h=0;h<d.cases.length;h++)for(i=d.cases[h],j=0;j<i.allow.length;j++)if(k=i.allow[j],l=null,l=k instanceof a.CodeObject?this.resolveOperand(k,c):k,l==e){f=!0,this.executable(i.executable,g);break}0==f&&null!=d.default&&this.executable(d.default.executable,g)},b.prototype.processTry=function(a,b){var d,f,g,c=a.value;try{d={value:void 0,isOver:!1,isContinue:!1,isBreak:!1,blockType:b.blockType,parent:b,context:{}},this.executable(c.tryExecutable,d)}catch(e){f={},f[c.identifier]=e,g={value:void 0,isOver:!1,isContinue:!1,isBreak:!1,blockType:b.blockType,parent:b,context:f},this.executable(c.catchExecutable,g)}},b.prototype.processThrow=function(a,b){var c=a.value,d=this.resolveOperand(c.obj,b);throw d},b.prototype.processNew=function(a,b){this.parseNew(a.value,b)},b.prototype.processDelete=function(a,b){this.parseDelete(a.value,b)},b.prototype.processTypeof=function(a,b){var c=a.value;typeof this.resolveOperand(c.value,b)},b.prototype.processCallForSimple=function(b,c){var f,g,h,i,j,k,d=b.value,e=this.resolveOperand(d.begin,c);if("number"!=typeof e)throw new a.ExecutionError(d.token,"forsimple 初始值必须是number");if(f=this.resolveOperand(d.finished,c),"number"!=typeof f)throw new a.ExecutionError(d.token,"forsimple 最大值必须是number");if(null!=d.step){if(h=this.resolveOperand(d.step,c),"number"!=typeof h)throw new a.ExecutionError(d.token,"forsimple Step必须是number");g=h}else g=1;for(i=d.variables,j=e;f>=j&&(i[d.identifier]=j,k={value:void 0,isOver:!1,isContinue:!1,isBreak:!1,blockType:a.BlockType.For,parent:c,context:{}},this.executable(d.blockExecutable,k),!k.isBreak)&&!k.isOver;j+=g)!k.isContinue},b.prototype.isSupportBreak=function(b){return b==a.BlockType.For||b==a.BlockType.Forin||b==a.BlockType.While},b.prototype.isSupportContinue=function(b){return b==a.BlockType.For||b==a.BlockType.Forin||b==a.BlockType.While},b.prototype.processVar=function(a,b){var c=a.value;b.context[c]=null},b.prototype.processReturn=function(a,b){this.invokeReturnValue(this.resolveOperand(a.value,b),b)},b.prototype.invokeReturnValue=function(b,c){c.isOver=!0,c.blockType==a.BlockType.Function?c.value=b:this.invokeReturnValue(b,c.parent)},b.prototype.processCondition=function(a,b,c){if(null==a)return!1;if(null!=a.allow){var d=this.resolveOperand(a.allow,c);if(!d)return!1}return this.executable(a.executable,{value:void 0,isOver:!1,isContinue:!1,isBreak:!1,blockType:b,parent:c,context:{}}),!0},b.prototype.processCallIf=function(b,c){var e,d=b.value;if(!this.processCondition(d.If,a.BlockType.If,c)){for(e=0;e<d.elseIf.length;++e)if(this.processCondition(d.elseIf[e],a.BlockType.If,c))return;this.processCondition(d.Else,a.BlockType.If,c)}},b.prototype.processResolve=function(a,b){this.resolveOperand(a.value,b)},b.prototype.processCallFunction=function(a,b){this.parseCall(a.value,b)},b.prototype.parseOperate=function(b,c){var f,d=b.operator,e=this.resolveOperand(b.left,c);if(d==a.TokenType.Plus)return f=this.resolveOperand(b.right,c),e+f;if(d==a.TokenType.Minus||d==a.TokenType.Multiply||d==a.TokenType.Divide||d==a.TokenType.Modulo||d==a.TokenType.InclusiveOr||d==a.TokenType.Combine||d==a.TokenType.XOR||d==a.TokenType.Shr||d==a.TokenType.Shi){if("number"!=typeof e)throw new a.ExecutionError(b.token,"运算符[左边]必须是number类型");if(f=this.resolveOperand(b.right,c),"number"!=typeof f)throw new a.ExecutionError(b.token,"运算符[右边]必须是number类型");switch(d){case a.TokenType.Minus:return e-f;case a.TokenType.Multiply:return e*f;case a.TokenType.Divide:return e/f;case a.TokenType.Modulo:return e%f;case a.TokenType.InclusiveOr:return e|f;case a.TokenType.Combine:return e&f;case a.TokenType.XOR:return e^f;case a.TokenType.Shr:return e>>f;case a.TokenType.Shi:return e<<f}}else{if(d!=a.TokenType.And&&d!=a.TokenType.Or&&d!=a.TokenType.Equal&&d!=a.TokenType.NotEqual&&d!=a.TokenType.Greater&&d!=a.TokenType.GreaterOrEqual&&d!=a.TokenType.Less&&d!=a.TokenType.LessOrEqual){if(d==a.TokenType.Instanceof)return f=this.resolveOperand(b.right,c),e instanceof f;throw new a.ExecutionError(b.token,"nonsupport operate ["+d+"] with "+e.Type)}switch(d){case a.TokenType.And:return e?(f=this.resolveOperand(b.right,c),e&&f):e;case a.TokenType.Or:return e?e:(f=this.resolveOperand(b.right,c),e||f);case a.TokenType.Equal:return f=this.resolveOperand(b.right,c),e==f;case a.TokenType.NotEqual:return f=this.resolveOperand(b.right,c),e!=f;case a.TokenType.Greater:return f=this.resolveOperand(b.right,c),e>f;case a.TokenType.GreaterOrEqual:return f=this.resolveOperand(b.right,c),e>=f;case a.TokenType.Less:return f=this.resolveOperand(b.right,c),f>e;case a.TokenType.LessOrEqual:return f=this.resolveOperand(b.right,c),f>=e}}},b.prototype.resolveOperand=function(b,c){if(null==b)return null;var d=this.resolveOperand_impl(b,c);if(b.not&&(d=!d),b.doubleNot)d=!!d;else if(b.negative){if("number"!=typeof d)throw new a.ExecutionError(b.token,"Script Object Type ["+d.Type+"] is cannot use [-] sign");d=-d}return d},b.prototype.resolveOperand_impl=function(b,c){var d,e;if(b instanceof a.CodeTypeof)return typeof this.resolveOperand(b.value,c);if(b instanceof a.CodeScriptObject)return b.value;if(b instanceof a.CodeDelete)return this.parseDelete(b,c);if(b instanceof a.CodeFunction)return this.parseExecutable(b,c);if(b instanceof a.CodeCallFunction)return this.parseCall(b,c);if(b instanceof a.CodeMember)return this.getVariable(b,c);if(b instanceof a.CodeArray)return this.parseArray(b,c);if(b instanceof a.CodeClass){if(b.isObject){d={};for(e in b.variableMap)d[e]=this.resolveOperand(b.variableMap[e].value,c);return d}return this.getClass(b)}return b instanceof a.CodeOperator?this.parseOperate(b,c):b instanceof a.CodeTernary?this.parseTernary(b,c):b instanceof a.CodeAssign?this.parseAssign(b,c):b instanceof a.CodeNew?this.parseNew(b,c):null},b.prototype.parseDelete=function(a,b){return this.setVariable(a.value,void 0,b)},b.prototype.parseCall=function(b,c){var e,f,h,i,j,k,d=[];for(e=0;e<b.parameters.length;e++)d.push(this.resolveOperand(b.parameters[e],c));if(f=null,!(b instanceof a.CodeFunction)){if(f=b.member instanceof a.CodeObject?this.resolveOperand(b.member,c):b.member,!f)throw new a.ExecutionError(b.token,"Cannot read property '"+b.member.value+"' of undefined");return b.isNew?(j=this.currentThis,k=new(f.bind.apply(f,[null].concat(d))),this.currentThis=j,k):(h=!1,b.member instanceof a.CodeMember&&(i=b.member.parent,i||(h="super"==b.member.value,h&&(f=this.currentThis[".super"]))),j=this.currentThis,this.currentThis=b.member[".this"]?b.member[".this"]:this.parser.globalObj,k=h?f.apply(j,d):f.apply(this.currentThis,d),this.currentThis=j,k)}f=this.resolveOperand(b,c),f.apply(this.parser.globalObj,d)},b.prototype.parseTernary=function(a,b){var c=this.resolveOperand(a.allow,b);return c?this.resolveOperand(a.true,b):this.resolveOperand(a.false,b)},b.prototype.getClass=function(a){var b,c,d;if(a.owner){for(b=this.getPathList(a),c=this.parser.globalObj,d=0;d<b.length;d++)c=c[b[d]];return c}return this.parser.globalObj[a.name]},b.prototype.getClassPath=function(a){var d,b=this.getPathList(a),c="";for(d=0;d<b.length;d++)c+=b[d]+".";return c&&(c=c.substring(0,c.length-1)),c},b.prototype.getPathList=function(a){var b=[a.name],c=a.owner;if(c)for(b.push(c.value);c.parent;)c=c.parent,b.push(c.value);return b.reverse(),b},b.prototype.parseNew=function(b,c){var e,d=!1;if(b.newObject instanceof a.CodeCallFunction&&(d=!0,b.newObject.isNew=!0),e=this.resolveOperand(b.newObject,c),null==e)throw new a.ExecutionError(b.token,"要实例化的类["+e+"]不存在");return d?e:new e},b.prototype.parseArray=function(a,b){var d,c=[];for(d=0;d<a.elements.length;++d)c.push(this.resolveOperand(a.elements[d],b));return c},b.prototype.getContextValue=function(a,b){for(;a&&!a.context.hasOwnProperty(b);)a=a.parent;return a?a.context[b]:this.currentThis&&this.currentThis.hasOwnProperty(b)?this.currentThis[b]:this.codeClass.owner?this.parser.globalObj[this.codeClass.owner.value][b]||this.parser.globalObj[b]:this.parser.globalObj[b]},b.prototype.getVariable=function(b,c){var d,e,f,g,h,i,j,k,l;if(b.parent){for(d=b,e=[b];b.parent;)b=b.parent,e.push(b);for(e.reverse(),f=void 0,e[0]instanceof a.CodeCallFunction?f=this.resolveOperand(b,c):void 0===f&&(f=this.getContextValue(c,this.getMemberValue(e[0],c))),e.length>0&&("this"==e[0].value&&(f=this.currentThis),"super"==e[0].value&&(f=this.currentThis[".super"].prototype)),d[".this"]=f,f&&e.shift(),g=this.parser.classPathMap,h=void 0,i=0;i<e.length;i++)f&&(h=f,f=e[i]instanceof a.CodeCallFunction?this.resolveOperand(e[i],c):f[this.getMemberValue(e[i],c)]),g&&(g=g[e[i].value]);if(d[".this"]=h,void 0===f&&g)return j=this.codeClass,f=this.parseClass(g),this.codeClass=j,f}else if("this"==b.value)f=this.currentThis;else if("super"==b.value)f=this.currentThis[".super"].prototype;else if(k=this.getMemberValue(b,c),f=this.getContextValue(c,k),void 0===f){for(l=this.getPathList(this.codeClass),l.pop(),f=this.parser.globalObj,i=0;i<l.length;i++)f=f[l[i]];f=f[k]||this.parser.globalObj[k]}if(b instanceof a.CodeMember&&b.calc!=a.Calc.NONE){if("number"!=typeof f)throw new a.ExecutionError(b.token,"++或者--只能应用于Number类型");b.calc==a.Calc.POST_DECREMENT?f--:b.calc==a.Calc.POST_INCREMENT?f++:b.calc==a.Calc.PRE_DECREMENT?--f:b.calc==a.Calc.PRE_INCREMENT&&++f,this.setVariable(b,f,c)}return f},b.prototype.getMemberValue=function(b,c){return b.value instanceof a.CodeScriptObject?b.value.value:"boolean"==typeof b.value||"number"==typeof b.value||"string"==typeof b.value?b.value:b instanceof a.CodeMember?this.resolveOperand(b.value,c):this.resolveOperand(b,c)},b.prototype.setVariable=function(b,c,d){var e,f,g,h,i,j,k,l,m;if(b.parent){for(e=b,f=[b];b.parent;)b=b.parent,f.push(b);for(f.reverse(),g=void 0,f[0]instanceof a.CodeCallFunction?g=this.resolveOperand(b,d):void 0===g&&(g=this.getContextValue(d,this.getMemberValue(f[0],d))),f.length>0&&("this"==f[0].value&&(g=this.currentThis),"super"==f[0].value&&(g=this.currentThis[".super"].prototype)),e[".this"]=g,g&&f.shift(),h=this.parser.classPathMap,i=void 0,j=0;j<f.length;j++)g&&(i=g,g=f[j]instanceof a.CodeCallFunction?this.resolveOperand(f[j],d):g[this.getMemberValue(f[j],d)]),h&&(h=h[f[j].value]);if(e[".this"]=i,i&&void 0===c)return delete i[this.getMemberValue(e,d)];i&&(i[this.getMemberValue(e,d)]=c)}else{for(k=this.getMemberValue(b,d),l=d,m=!1;d&&void 0===d.context[k]&&d.parent;)if(d=d.parent,void 0!==d.context[k]){d.context[k]=c,m=!0;
break}m||(l.context[this.getMemberValue(b,d)]=c)}},b.prototype.parseAssign=function(b,c){var d,e;if(b.assignType==a.TokenType.Assign)return d=this.resolveOperand(b.value,c),this.setVariable(b.member,d,c),d;if(d=this.getVariable(b.member,c),"string"==typeof d){if(b.assignType==a.TokenType.AssignPlus)return d+=this.resolveOperand(b.value,c),this.setVariable(b.member,d,c),d;throw new a.ExecutionError(b.token,"string类型只支持[+=]赋值操作")}if("number"==typeof d){if(e=this.resolveOperand(b.value,c),"number"!=typeof d)throw new a.ExecutionError(b.token,"[+= -=...]值只能为 number类型");switch(b.assignType){case a.TokenType.AssignPlus:d+=e;break;case a.TokenType.AssignMinus:d-=e;break;case a.TokenType.AssignMultiply:d*=e;break;case a.TokenType.AssignDivide:d/=e;break;case a.TokenType.AssignModulo:d%=e;break;default:throw new a.ExecutionError(b.token,"Double不支持的运算符 "+b.assignType)}return this.setVariable(b.member,d,c),d}throw new a.ExecutionError(b.token,"[+= -=...]左边值只能为number或者string")},b}();a.Runtime=b}(qs||(qs={})),function(a){function b(b,c,d,e){var f,g,h,i,j,k,l;for(void 0===e&&(e=!0),f=new a.Lexer(b),g=new a.Parser(f.getTokens(),d),h=new a.Runtime,i=c.split("."),j=g.classPathMap,k=0;k<i.length;k++)j=j[i[k]];if(!j)throw"不存在的类："+c+"，请检查类路径是否正确，并且是否已经载入";return l=h.run(j,g),e?new l:l}a.run=b}(qs||(qs={})),function(a){var b=function(){function a(){this.dataStore=[],this.top=0}return a.prototype.pop=function(){return this.dataStore[--this.top]},a.prototype.push=function(a){this.dataStore[this.top++]=a},a.prototype.peek=function(){return this.dataStore[this.top-1]},a.prototype.clear=function(){this.top=0},Object.defineProperty(a.prototype,"length",{get:function(){return this.top},enumerable:!0,configurable:!0}),a}();a.Stack=b}(qs||(qs={})),function(a){var b=function(){function a(){}return a.isLetter=function(a){return new RegExp("[A-Za-z]").test(a)?!0:!1},a.isDigit=function(a){return new RegExp("[0-9]").test(a)?!0:!1},a.isNullOrEmpty=function(a){return null==a||""==a},a.isLetterOrDigit=function(a){return new RegExp("[A-Za-z0-9]").test(a)?!0:!1},a.isHexDigit=function(b){return a.isDigit(b)?!0:b>="a"&&"f">=b?!0:b>="A"&&"F">=b?!0:!1},a}();a.Utils=b}(qs||(qs={})),window.qs=qs;